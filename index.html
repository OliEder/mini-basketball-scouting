<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Basketball Scouting App - U10 Bezirksliga</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/mini-basketball-scouting/manifest.json">

    <!-- Theme Colors -->
    <meta name="theme-color" content="#1f2937">
    <meta name="msapplication-navbutton-color" content="#1f2937">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Mobile App Capabilities -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="B-Scout">

    <!-- Icons -->
    <link rel="apple-touch-icon" href="/mini-basketball-scouting/icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/mini-basketball-scouting/icon/favicon-96x96.png">
    <link rel="icon" href="/mini-basketball-scouting/icon/favicon.ico">

    <!-- SEO -->
    <meta name="description" content="Basketball Scouting App fuer U10 Minibasketball - Bewerte gegnerische Spieler offline">
    <meta name="keywords" content="Basketball, Scouting, U10, Minibasketball, Offline, PWA">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/mini-basketball-scouting/style.css">
</head>
<body>
    <!-- Update Banner -->
    <div id="updateBanner" class="update-banner">
        Neue Version verfuegbar!
        <button id="updateButton" class="update-button">Aktualisieren</button>
    </div>

    <!-- App Container -->
    <div id="app" class="app-container">
        <!-- Game Selection Screen -->
        <div id="gameSelectionScreen" class="screen active">
            <div class="container">
                <header class="app-header">
                    <h1>Basketball Scouting</h1>
                    <p class="subtitle">U10 mixed Bezirksliga (Oberpfalz)</p>
                </header>

                <div class="card">
                    <div class="card__header">
                        <h2>Spiel auswaehlen</h2>
                    </div>
                    <div class="card__body">
                        <div class="form-group">
                            <label for="gameSelect" class="form-label">Kommendes Spiel auswaehlen:</label>
                            <select id="gameSelect" class="form-control">
                                <option value="">Spiel auswaehlen...</option>
                            </select>
                        </div>

                        <div class="team-selection">
                            <h3>Welches Team sind wir?</h3>
                            <div class="team-options">
                                <label class="team-radio">
                                    <input type="radio" name="ownTeam" value="home" id="homeTeamRadio">
                                    <span class="radio-text">Wir sind die Heimmannschaft</span>
                                </label>
                                <label class="team-radio">
                                    <input type="radio" name="ownTeam" value="away" id="awayTeamRadio">
                                    <span class="radio-text">Wir sind die Gastmannschaft</span>
                                </label>
                            </div>
                        </div>

                        <div class="game-info" id="selectedGameInfo" style="display: none;">
                            <h3>Ausgewaehltes Spiel:</h3>
                            <div class="game-details">
                                <p><strong>Datum & Zeit:</strong> <span id="gameDateTime"></span></p>
                                <p><strong>Spielhalle:</strong> <span id="gameVenue"></span></p>
                                <p><strong>Unser Team:</strong> <span id="ourTeam"></span></p>
                                <p><strong>Zu scoutender Gegner:</strong> <span id="opponentTeam"></span></p>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button id="startScoutingBtn" class="btn btn--primary btn--large" disabled>
                                Scouting starten
                            </button>
                            <button id="manualGameBtn" class="btn btn--outline">
                                Spiel manuell eingeben
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Player Overview Screen -->
        <div id="playerOverviewScreen" class="screen">
            <div class="container">
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">Spiel</span>
                    <span class="breadcrumb-separator">></span>
                    <span class="breadcrumb-item active">Spieler-Uebersicht</span>
                </nav>

                <header class="screen-header">
                    <h2 id="playerRatingTitle">Bewertete Spieler</h2>
                    <button class="btn btn--primary" id="addPlayerBtn">
                        Spieler hinzufuegen
                    </button>
                </header>

                <div id="playersList" class="players-list">
                    <div class="empty-state">
                        <div class="empty-icon">Basketball</div>
                        <h3>Noch keine Spieler bewertet</h3>
                        <p>Fuegen Sie den ersten Spieler hinzu, um mit dem Scouting zu beginnen</p>
                    </div>
                </div>

                <div class="screen-actions">
                    <button class="btn btn--outline" id="backToGameSelection">
                        Spiel wechseln
                    </button>
                    <button class="btn btn--secondary" id="exportDataBtn">
                        Export
                    </button>
                </div>
            </div>
        </div>

        <!-- Player Rating Screen -->
        <div id="playerRatingScreen" class="screen">
            <div class="container">
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">Uebersicht</span>
                    <span class="breadcrumb-separator">></span>
                    <span class="breadcrumb-item active">Spieler bewerten</span>
                </nav>

                <header class="screen-header">
                    <h2 id="playerRatingTitle">Spieler bewerten</h2>
                </header>

                <div class="card">
                    <div class="card__body">
                        <div class="form-group">
                            <label for="jerseyNumber" class="form-label">Trikotnummer:</label>
                            <input type="number" id="jerseyNumber" class="form-control form-control--large" 
                                   placeholder="z.B. 23" min="0" max="99">
                        </div>

                        <!-- Rating Categories -->
                        <div id="ratingCategories" class="rating-categories">
                            <!-- Categories will be populated by JavaScript -->
                        </div>

                        <div class="form-actions">
                            <button class="btn btn--outline" id="cancelRating">
                                Abbrechen
                            </button>
                            <button class="btn btn--primary btn--large" id="savePlayerRating">
                                Spieler speichern
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Screen -->
        <div id="exportScreen" class="screen">
            <div class="container">
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">Uebersicht</span>
                    <span class="breadcrumb-separator">></span>
                    <span class="breadcrumb-item active">Export</span>
                </nav>

                <header class="screen-header">
                    <h2>Daten exportieren</h2>
                </header>

                <div class="export-options">
                    <div class="card">
                        <div class="card__header">
                            <h3>Aktuelles Spiel</h3>
                        </div>
                        <div class="card__body">
                            <p>Export der aktuellen Scouting-Daten</p>
                            <div class="button-group">
                                <button class="btn btn--secondary" id="exportCurrentJSON">
                                    JSON Export
                                </button>
                                <button class="btn btn--secondary" id="exportCurrentCSV">
                                    CSV Export
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__header">
                            <h3>Alle Spiele</h3>
                        </div>
                        <div class="card__body">
                            <p>Export aller gespeicherten Scouting-Daten</p>
                            <div class="button-group">
                                <button class="btn btn--secondary" id="exportAllJSON">
                                    Vollstaendiger JSON Export
                                </button>
                                <button class="btn btn--secondary" id="exportAllCSV">
                                    Vollstaendiger CSV Export
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card card--danger">
                        <div class="card__header">
                            <h3>Einstellungen</h3>
                        </div>
                        <div class="card__body">
                            <p>Vorsicht: Diese Aktion kann nicht rueckgaengig gemacht werden!</p>
                            <button class="btn btn--danger" id="clearAllData">
                                Alle Daten loeschen
                            </button>
                        </div>
                    </div>
                </div>

                <div class="screen-actions">
                    <button class="btn btn--outline" id="backToOverview">
                        Zurueck zur Uebersicht
                    </button>
                </div>
            </div>
        </div>

        <!-- Manual Game Entry Screen -->
        <div id="manualGameScreen" class="screen">
            <div class="container">
                <header class="screen-header">
                    <h2>Spiel manuell eingeben</h2>
                </header>

                <div class="card">
                    <div class="card__body">
                        <div class="form-group">
                            <label for="manualOurTeam" class="form-label">Unser Team:</label>
                            <input type="text" id="manualOurTeam" class="form-control" 
                                   placeholder="z.B. TSV Mannheim">
                        </div>

                        <div class="form-group">
                            <label for="manualOpponent" class="form-label">Gegner:</label>
                            <input type="text" id="manualOpponent" class="form-control" 
                                   placeholder="z.B. TV Bruehl">
                        </div>

                        <div class="form-group">
                            <label for="manualDate" class="form-label">Datum:</label>
                            <input type="date" id="manualDate" class="form-control">
                        </div>

                        <div class="form-actions">
                            <button class="btn btn--outline" id="cancelManualGame">
                                Abbrechen
                            </button>
                            <button class="btn btn--primary" id="saveManualGame">
                                Spiel erstellen
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmation Dialog -->
        <div id="confirmationDialog" class="modal">
            <div class="modal-content">
                <header class="modal-header">
                    <h3>Bestaetigung</h3>
                </header>
                <div class="modal-body">
                    <p id="confirmationMessage">Sind Sie sicher?</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--outline" id="cancelConfirmation">
                        Abbrechen
                    </button>
                    <button class="btn btn--danger" id="confirmAction">
                        Bestaetigen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/mini-basketball-scouting/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/mini-basketball-scouting/sw.js')
                    .then(function(registration) {
                        console.log('Service Worker registered successfully:', registration.scope);

                        // Check for updates
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            console.log('New service worker found, installing...');

                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        // New update available
                                        showUpdateBanner();
                                    } else {
                                        console.log('App is cached for offline use');
                                        showInstallPrompt();
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        let installButton;

        // Create install button
        function createInstallButton() {
            if (!installButton) {
                installButton = document.createElement('button');
                installButton.className = 'pwa-install-button';
                installButton.innerHTML = 'App installieren';

                installButton.addEventListener('click', async function() {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const result = await deferredPrompt.userChoice;
                        console.log('Install prompt result:', result.outcome);
                        deferredPrompt = null;
                        installButton.style.display = 'none';
                    }
                });

                document.body.appendChild(installButton);
            }
        }

        // Show install prompt
        function showInstallPrompt() {
            if (!localStorage.getItem('pwa-install-dismissed')) {
                createInstallButton();
                if (installButton) {
                    installButton.style.display = 'block';
                }
            }
        }

        // Before install prompt
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('PWA Install prompt triggered');
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });

        // App installed successfully
        window.addEventListener('appinstalled', function(evt) {
            console.log('PWA installed successfully');
            if (installButton) {
                installButton.style.display = 'none';
            }
            deferredPrompt = null;
        });

        // Update banner functions
        function showUpdateBanner() {
            const banner = document.getElementById('updateBanner');
            const updateButton = document.getElementById('updateButton');

            if (banner) {
                banner.classList.add('show');

                updateButton.addEventListener('click', function() {
                    window.location.reload();
                });
            }
        }

        // Online/Offline Status
        function updateOnlineStatus() {
            const body = document.body;
            if (navigator.onLine) {
                console.log('App is online');
                body.classList.remove('offline');
            } else {
                console.log('App is offline');
                body.classList.add('offline');
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        document.addEventListener('DOMContentLoaded', updateOnlineStatus);

        // Prevent zoom on iOS
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });

        // Performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    if (perfData) {
                        console.log('Page Load Time:', Math.round(perfData.loadEventEnd - perfData.loadEventStart), 'ms');
                    }
                }, 0);
            });
        }

        // Debug info
        console.log('Basketball Scouting App initialized');
        console.log('PWA features:', {
            serviceWorker: 'serviceWorker' in navigator,
            manifest: document.querySelector('link[rel="manifest"]') !== null,
            offline: !navigator.onLine
        });
    </script>
</body>
</html>